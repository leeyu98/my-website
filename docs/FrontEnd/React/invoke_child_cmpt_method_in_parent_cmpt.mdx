---
title: çˆ¶ç»„ä»¶ä¸­è°ƒç”¨å­ç»„ä»¶ä¸­çš„æ–¹æ³•
description: åœ¨ç±»ç»„ä»¶å’Œå‡½æ•°ç»„ä»¶ä¸­å¦‚ä½•é€šè¿‡çˆ¶ç»„ä»¶è§¦å‘å­ç»„ä»¶çš„æ–¹æ³•
sidebar_position: 2
displayed_sidebar: frontendSidebar
---

<Author count publish="2023-05-4 18:42:00" update="2023-05-13 00:51:00" />

> æ–‡ç« ä¸­æ¶‰åŠ `ref` çš„åº”ç”¨ä»…ä¸ºçˆ¶ç»„ä»¶è°ƒç”¨å­ç»„ä»¶åœºæ™¯ä¸‹çš„åº”ç”¨æ–¹å¼ï¼Œå¹¶æœªæ¶µç›– `ref` çš„æ‰€æœ‰åº”ç”¨æ–¹å¼ï¼

## Class ç»„ä»¶

### 1. è‡ªå®šä¹‰äº‹ä»¶

<Tabs>
<TabItem value="parent" label="çˆ¶ç»„ä»¶" default>

```js {10,20} showLineNumbers title=Parent.js
import React, { Component } from 'react';
import Child from './Child';

class Parent extends Component {
  componentDidMount() {
    console.log(this.childRef);
  }
  handleChildEvent = (ref) => {
    // å°†å­ç»„ä»¶çš„å®ä¾‹å­˜åˆ° this.childRef ä¸­, è¿™æ ·æ•´ä¸ªçˆ¶ç»„ä»¶å°±èƒ½æ‹¿åˆ°
    this.childRef = ref;
  };
  //æŒ‰é’®äº‹ä»¶å¤„ç†
  handleClick = () => {
    // é€šè¿‡å­ç»„ä»¶çš„å®ä¾‹è°ƒç”¨ç»„ç»„ä»¶ä¸­çš„æ–¹æ³•
    this.childRef.sendMessage();
  };
  render() {
    return (
      <>
        <Child onChildEvent={this.handleChildEvent} />
        <button onClick={this.handleClick}>Trigger Child Event</button>
      </>
    );
  }
}

export default Parent;
```

</TabItem >
<TabItem value="child" label="å­ç»„ä»¶" default>

```js title=Child.js
import React, { Component } from 'react';

export default class Child extends Component {
  //å­ç»„ä»¶å®ŒæˆæŒ‚è½½æ—¶, å°†å­ç»„ä»¶çš„æ–¹æ³• this ä½œä¸ºå‚æ•°ä¼ åˆ°çˆ¶ç»„ä»¶çš„å‡½æ•°ä¸­
  componentDidMount() {
    // åœ¨å­ç»„ä»¶ä¸­è°ƒç”¨çˆ¶ç»„ä»¶çš„æ–¹æ³•,å¹¶æŠŠå½“å‰çš„å®ä¾‹ä¼ è¿›å»
    this.props.onChildEvent(this);
  }
  // å­ç»„ä»¶çš„æ–¹æ³•, åœ¨çˆ¶ç»„ä»¶ä¸­è§¦å‘
  sendMessage = () => {
    console.log('sending message');
  };
  render() {
    return <span>Child</span>;
  }
}
```

</TabItem>
</Tabs>

### 2. ä½¿ç”¨ React.createRef()

<Tabs>
<TabItem value="parent" label="çˆ¶ç»„ä»¶" default>

```js {8,17} showLineNumbers title=Parent.js
import React, { Component } from 'react';
import Child from './Child';

export default class Parent extends Component {
  constructor(props) {
    super(props);
    this.childRef = React.createRef(); // åˆ›å»ºRef
  }
  // ç›´æ¥é€šè¿‡ this.childRef.current æ‹¿åˆ°å­ç»„ä»¶å®ä¾‹
  handleClick = () => {
    this.childRef.current.sendMessage();
  };
  render() {
    return (
      <>
        <ChildCmp ref={this.childRef} />
        <button onClick={this.handleClick}>Trigger Child Event</button>
      </>
    );
  }
}
```

</TabItem>
<TabItem value="child" label="å­ç»„ä»¶" >

> è€Œå­ç»„ä»¶å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„ç»„ä»¶

```js title=Child.js
import React, { Component } from 'react';

export default class Child extends Component {
  sendMessage = () => {
    console.log('sending message');
  };
  render() {
    return <span>Child</span>;
  }
}
```

  </TabItem >
</Tabs>

### 3. å›è°ƒ Refs

å›è°ƒ `Refs` æ˜¯å¦ä¸€ç§è®¾ç½® `Ref` çš„æ–¹å¼ï¼Œå®ƒèƒ½åŠ©ä½ æ›´ç²¾ç»†åœ°æ§åˆ¶ä½•æ—¶ `refs` è¢«è®¾ç½®å’Œè§£é™¤ã€‚

ä¸åŒäºä¼ é€’ `React.createRef()` åˆ›å»ºçš„ `ref` å±æ€§ï¼Œéœ€è¦ä¼ é€’ä¸€ä¸ªå‡½æ•°ã€‚ğŸ’ è®¿é—® `Ref` çš„æ—¶å€™ä¹Ÿä¸éœ€è¦ `current`ã€‚

<Tabs>
<TabItem value="parent" label="çˆ¶ç»„ä»¶" default>

```js {7,11,22} showLineNumbers title=Parent.js
import React from 'react';
import Child from './Child';

export default class Parent extends React.Component {
  constructor(props) {
    super(props);
    this.childRef = null; // åˆ›å»º Refï¼Œä¸é€šè¿‡ React.createRef()
  }
  // è®¾ç½® Ref
  setChildRef = (ref) => {
    this.childRef = ref;
  };

  // ç›´æ¥é€šè¿‡ this.childRef æ‹¿åˆ°å­ç»„ä»¶å®ä¾‹
  handleClick = () => {
    this.childRef.sendMessage(`Trigger Child Event from Parent`);
  };

  render() {
    return (
      <Reaact.Fragment>
        <ChildCmp ref={this.setChildRef} />
        <button onClick={this.handleClick}>Trigger Child Event</button>
      </Reaact.Fragment>
    );
  }
}
```

</TabItem>
<TabItem value="child" label="å­ç»„ä»¶" >

> è€Œå­ç»„ä»¶å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„ç»„ä»¶

```js title=Child.js
import React from 'react';

export default class Child extends React.Component {
  sendMessage = (message) => {
    console.log('sending message:', message);
  };
  render() {
    return <span>Child</span>;
  }
}
```

</TabItem >
</Tabs>

:::tip å°ç»“

å¯¹æ¯”è‡ªå®šä¹‰äº‹ä»¶æ–¹å¼ï¼Œå›è°ƒ `Refs` æ›´åƒæ˜¯ç²¾ç®€çš„è‡ªå®šä¹‰äº‹ä»¶æ–¹å¼ï¼š

- è‡ªå®šä¹‰äº‹ä»¶åç§°å˜æˆäº† `ref`
- å­ç»„ä»¶å†…ä¸éœ€è¦æ‰‹åŠ¨ç»‘å®š

:::

## Function ç»„ä»¶

é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸èƒ½åœ¨å‡½æ•°ç»„ä»¶ä¸Šä½¿ç”¨ `ref` å±æ€§ï¼Œå› ä¸ºå®ƒä»¬æ²¡æœ‰å®ä¾‹ã€‚æ‰€ä»¥ä¸Šé¢çš„ä¸¤ç§æ–¹å¼æ˜¯è¡Œä¸é€šçš„ã€‚
è§£å†³åŠæ³•å°±æ˜¯ä½¿ç”¨ `forwardRef` å’Œ `useImperativeHandle`ã€‚

> <Emphasis>ä¸è¿‡åœ¨å‡½æ•°çš„å†…éƒ¨æ˜¯å¯ä»¥ä½¿ç”¨ useRef é’©å­æ¥è·å–ç»„ä»¶å†…çš„ DOM å…ƒç´ ã€‚</Emphasis>

### 1. forwardRef å’Œ useImperativeHandle

<Tabs>
<TabItem value="parent" label="çˆ¶ç»„ä»¶" default>

```js {5,11} showLineNumbers title=Parent.js
import React from 'react';
import Child from './Child';

const Parent = () => {
  const childRef = React.useRef(null); // é€šè¿‡ Hooks åˆ›å»º Ref
  const handleClick = () => {
    childRef.current.sendMessage();
  };
  return (
    <Reaact.Fragment>
      <Child ref={childRef} />
      <button onClick={handleClick}>Trigger Child Event</button>
    </Reaact.Fragment>
  );
};

export default Parent;
```

</TabItem>
<TabItem value="child" label="å­ç»„ä»¶" >

```js {8-10} showLineNumbers title=Child.js
import React, { forwardRef, useImperativeHandle } from 'react';

const Child = forwardRef((props, ref) => {
  const sendMessage = () => {
    console.log('sending message');
  };
  //å°†å­ç»„ä»¶çš„æ–¹æ³• æš´éœ²ç»™çˆ¶ç»„ä»¶
  useImperativeHandle(ref, () => ({
    sendMessage,
  }));
  return <span>Child</span>;
});

export default Child;
```

  </TabItem >
</Tabs>

### 2. è‡ªå®šä¹‰ props å’Œ useImperativeHandle

åªéœ€å°† `ref` æ›¿æ¢ä¸º `props`

<Tabs>
<TabItem value="parent" label="çˆ¶ç»„ä»¶" default>

```js title=Parent.js
import React from 'react';
import Child from './Child';

const Parent = () => {
  const childRef = React.useRef(null); // é€šè¿‡ Hooks åˆ›å»º Ref
  const handleClick = () => {
    childRef.current.sendMessage();
  };
  return (
    <Reaact.Fragment>
      <Child onRef={childRef} />
      <button onClick={handleClick}>Trigger Child Event</button>
    </Reaact.Fragment>
  );
};

export default Parent;
```

</TabItem>
<TabItem value="child" label="å­ç»„ä»¶" >

```js {8-10} showLineNumbers title=Child.js
import React, { useImperativeHandle } from 'react';

const Child = (props) => {
  const sendMessage = () => {
    console.log('sending message');
  };
  //å°†å­ç»„ä»¶çš„æ–¹æ³• æš´éœ²ç»™çˆ¶ç»„ä»¶
  useImperativeHandle(props.onRef, () => ({
    sendMessage,
  }));
  return <span>Child</span>;
};

export default Child;
```

  </TabItem >
</Tabs>

:::caution æ³¨æ„
ä»¥ä¸Šä¾‹å­ä¸­åªæ˜¯ç®€å•åœ°æ¼”ç¤ºäº†çˆ¶å­ç»„ä»¶ä¹‹é—´çš„æ–¹æ³•è°ƒç”¨ï¼Œå½“ç„¶å®é™…æƒ…å†µä¸­å­ç»„ä»¶ä¸­å¯ä»¥ä¹Ÿä¼šæœ‰è‡ªå·±çš„ `ref` æŒ‡å‘è‡ªå·±å†…éƒ¨çš„ `DOM` å…ƒç´ ï¼Œä¸è¿‡è¿™äº›åŸç†éƒ½æ˜¯ä¸€æ ·çš„ã€‚
:::
